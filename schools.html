--- 
layout: default 
---

{% assign schools = site.data.schools %}

<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 500px;
      }

</style>

<div id="map"></div>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key={{ site.google_maps_js_key }}&callback=initMap">
</script>
<script>

    function initMap() {

        var map = new google.maps.Map(document.getElementById('map'))

        var geocoder = new google.maps.Geocoder;
        
        schools = { }
        {% for school in schools %} 
        schools['{{ school.placeId }}'] = '{{ school.name }}'
        {% endfor %}
        

        var promisedResults = []

        for (let i in schools) {
            promisedResults.push(getResByPlaceId(i, geocoder, map));
        }

        Promise.all(promisedResults).then(function(resolvedResults){
            var bounds = new google.maps.LatLngBounds();
            var locations = []
            var markers = {}
            resolvedResults.forEach(function(res) {
                let latlng = {lat: res[0].geometry.location.lat(), lng: res[0].geometry.location.lng()}

                let name = schools[res[0].place_id] // may be a good use for Places

                console.log(res[0])

                let contentString = '<div id="content">'+
                    '<div id="siteNotice">'+
                    '</div>'+
                    '<h1 id="firstHeading" class="firstHeading">'+ name +'</h1>'+
                    '<div id="bodyContent">'+
                    '<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
                    'sandstone rock formation in the southern part of the '+
                    'Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) '+
                    'south west of the nearest large town, Alice Springs; 450&#160;km '+
                    '(280&#160;mi) by road. Kata Tjuta and Uluru are the two major '+
                    'features of the Uluru - Kata Tjuta National Park. Uluru is '+
                    'sacred to the Pitjantjatjara and Yankunytjatjara, the '+
                    'Aboriginal people of the area. It has many springs, waterholes, '+
                    'rock caves and ancient paintings. Uluru is listed as a World '+
                    'Heritage Site.</p>'+
                    '<p>Attribution: Uluru, <a href="https://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
                    'https://en.wikipedia.org/w/index.php?title=Uluru</a> '+
                    '(last visited June 22, 2009).</p>'+
                    '</div>'+
                    '</div>';

                let infowindow = new google.maps.InfoWindow({
                    content: contentString
                });

                let marker = new google.maps.Marker({ 
                    map: map,
                    position: latlng
                })

                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });

                markers[res[0].place_id] = marker;

                locations.push(latlng);
            });

            $(".marker-trigger").on("click", function() {
               let marker = markers[$(this).data("placeid")]
               google.maps.event.trigger(marker, 'click');
            })

            for (var m in locations) { 
                bounds.extend(locations[m]);
            }

            map.setCenter(bounds.getCenter());

            {% comment %} google.maps.event.addListenerOnce(map, 'bounds_changed', function(event) {
                this.setZoom(map.getZoom()-1);

                if (this.getZoom() > 15) {
                    this.setZoom(15);
                }
            }); {% endcomment %}

            map.fitBounds(bounds);
        })
        
    }

    function getResByAddress(address, geocoder) {
        return new Promise(function(resolve, reject) {
            geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') {
                    resolve(results);
                } else {
                    reject(new Error());
                }
            })
        })
    } 

    function getResByPlaceId(placeId, geocoder, callback) {
        return new Promise(function(resolve, reject) {
            geocoder.geocode({'placeId': placeId}, function(results, status) {
                if (status === 'OK') {
                    resolve(results);
                } else {
                    reject(new Error());
                }
            })
        })
    } 
</script>



<div> 
    <ul>
        {% for school in schools %} 
            <li><a class="marker-trigger" href="#" data-placeid="{{ school.placeId }}" data-name="{{ school.name }}">{{ school.name }}</a></li>
        {% endfor %}
    </ul>
</div>

{% comment %} 

 TODO:
    add ability to click links and zoom to their location + get info
    fit map content to box 
    click markers and get info
{% endcomment %}

{% comment %} --- 
layout: default 
---

{% assign schools = site.data.schools %}

<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

</style>

<div id="map"></div>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key={{ site.google_maps_js_key }}&callback=initMap">
</script>
<script>
    // This function is called when the user clicks the UI button requesting
    // a geocode of a place ID.
    function addMarkerByPlaceId(geocoder, placeId, map) {
        // var placeId = document.getElementById('place-id').value;
        geocoder.geocode({'placeId': placeId}, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    latlng = {lat: results[0].geometry.location.lat(), lng: results[0].geometry.location.lng()}
                    var marker = new google.maps.Marker({
                        position: latlng,
                        setMap: map
                    });
                }
            }
        });
    }

    function addMarkerByAddress(geocoder, address, map) {
        geocoder.geocode({'address': address}, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    latlng = {lat: results[0].geometry.location.lat(), lng: results[0].geometry.location.lng()}
                    var marker = new google.maps.Marker({
                        position: latlng,
                        setMap: map
                    });
                }
            }
        });
    }

    function initMap() {
        var myLatLng = {lat: 40.5008186, lng: -74.44739909999998}; // RU New Brunswick Lat/Lng

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8.5,
            center: myLatLng
        });

        var marker = new google.maps.Marker({
            position: myLatLng,
            setMap: map
        });

        geocoder = new google.maps.Geocoder;
        infowindow = new google.maps.InfoWindow;

        schools = [
            {% for school in schools %} 
                {
                    name: '{{ school.name }}',
                    placeId: '{{ school.placeId }}'
                },
            {% endfor %}
        ]
                
        for (var i in schools) {
            console.log(i)
            addMarkerByPlaceId(geocoder, schools[i].placeId, map)
        }

    }
</script>

<p> 
    {% for school in schools %} 
        <p>{{ school }}</p>
    {% endfor %}
</p> {% endcomment %}


{% comment %} 
 TODO:
    add ability to click links and zoom to their location + get info
    fit map content to box 
    click markers and get info
{% endcomment %}

